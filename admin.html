<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®é”å®¢æˆ¶éˆæ¥åˆ†ç™¼ä¸­å¿ƒ</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <style>
        body { 
            background-color: #f8f9fa; 
            font-family: "Microsoft JhengHei", sans-serif; 
            padding-bottom: 50px;
        }

        /* === 1. é ‚éƒ¨é»‘æ¢ (é‚„åŸèˆŠç‰ˆè¨­è¨ˆ) === */
        .top-header {
            background-color: #212529; /* é»‘è‰²èƒŒæ™¯ */
            color: #ffc107; /* é»ƒè‰²æ–‡å­— */
            padding: 15px;
            text-align: center;
            font-weight: 800;
            font-size: 1.3rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* === 2. æ‡¸æµ®æ§åˆ¶å€ (åŒ…å«æŒ‰éˆ•å’Œæœç´¢æ¡†) === */
        .sticky-controls {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: #f8f9fa; /* è·ŸèƒŒæ™¯ä¸€æ¨£é¡è‰² */
            padding-top: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        /* === 3. éŠ·å”®æŒ‰éˆ•çµ„ === */
        .sales-btn-group {
            display: flex;
            justify-content: center; /* å±…ä¸­é¡¯ç¤º */
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            padding: 0 10px;
        }

        .btn-sales {
            border-radius: 50px;
            padding: 8px 20px;
            font-weight: bold;
            border: 1px solid #ddd;
            background: white;
            color: #555;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .btn-sales:hover { background-color: #eee; }

        /* é¸ä¸­ç‹€æ…‹ï¼šé»ƒåº•é»‘å­— */
        .btn-sales.active {
            background-color: #ffc107;
            color: #000;
            border-color: #ffc107;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
            transform: scale(1.05);
        }

        /* === 4. æœç´¢æ¡† (æ–°å¢åŠŸèƒ½) === */
        .search-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 15px;
            position: relative;
        }
        .search-input {
            border-radius: 20px;
            padding-left: 40px; /* ç•™ä½ç½®çµ¦åœ–æ¨™ */
            border: 1px solid #ced4da;
        }
        .search-icon {
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: #adb5bd;
        }

        /* === 5. å®¢æˆ¶åˆ—è¡¨ (ç°¡æ½”åˆ—è¡¨æ¨£å¼) === */
        .client-list-container {
            max-width: 800px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .list-group-item {
            border: none;
            border-bottom: 1px solid #eee;
            padding: 15px;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-group-item:first-child { border-top-left-radius: 10px; border-top-right-radius: 10px; }
        .list-group-item:last-child { border-bottom-left-radius: 10px; border-bottom-right-radius: 10px; border-bottom: none; }

        .list-group-item:hover {
            background-color: #fff3cd; /* æ»‘é¼ æ‡¸åœè®Šæ·¡é»ƒ */
        }

        .c-name { font-size: 1.1rem; font-weight: bold; color: #333; }
        .c-code { font-size: 0.9rem; color: #888; font-family: Arial; }
        
        /* éˆæ¥æ¨£å¼ */
        a.client-link { text-decoration: none; display: block; width: 100%; }

        .no-result { text-align: center; color: #999; margin-top: 30px; display: none; }
    </style>
</head>
<body onload="initAdmin()">

    <div class="top-header">
        ğŸ¯ å®é”å®¢æˆ¶éˆæ¥åˆ†ç™¼ä¸­å¿ƒ
    </div>

    <div class="sticky-controls">
        <div class="sales-btn-group" id="salesBtnContainer">
            </div>

        <div class="search-container">
            <i class="bi bi-search search-icon"></i>
            <input type="text" id="searchInput" class="form-control search-input" placeholder="ğŸ” è¼¸å…¥åº—åæˆ–ç·¨è™Ÿå¿«é€ŸæŸ¥æ‰¾..." oninput="filterClients()">
        </div>
    </div>

    <div class="client-list-container">
        <div id="countDisplay" class="text-center text-muted mb-2" style="font-size: 0.85rem;"></div>
        <div class="list-group shadow-sm" id="clientList"></div>
        <div id="noResult" class="no-result">æ‰¾ä¸åˆ°ç›¸é—œå®¢æˆ¶ ğŸ˜…</div>
    </div>

    <script src="sales_config.js"></script>
    <script src="customers.js"></script>

    <script>
        let currentSales = "A"; // é»˜èªé¡¯ç¤ºå¿—å“¥

        function initAdmin() {
            renderSalesButtons();
            renderClients("A"); // åˆå§‹åŠ è¼‰å¿—å“¥
        }

        // æ¸²æŸ“éŠ·å”®æŒ‰éˆ•
        function renderSalesButtons() {
            const container = document.getElementById('salesBtnContainer');
            let html = `
                <button class="btn-sales" onclick="filterNewClients()">
                    <i class="bi bi-person-plus-fill"></i> æ–°å®¢æˆ¶å°ˆç”¨
                </button>
            `;

            if (typeof salesTeam !== 'undefined') {
                for (let id in salesTeam) {
                    const s = salesTeam[id];
                    const activeClass = (id === "A") ? "active" : ""; // é»˜èªé¸ä¸­ A
                    html += `<button class="btn-sales ${activeClass}" id="btn-${id}" onclick="switchSales('${id}')">${s.name} (${id})</button>`;
                }
            }
            container.innerHTML = html;
        }

        // åˆ‡æ›éŠ·å”®
        function switchSales(id) {
            currentSales = id;
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.btn-sales').forEach(b => b.classList.remove('active'));
            const btn = document.getElementById('btn-' + id);
            if(btn) btn.classList.add('active');

            // æ¸…ç©ºæœç´¢æ¬„ (æ›äººæ™‚é‡ç½®æœç´¢)
            document.getElementById('searchInput').value = '';
            document.getElementById('noResult').style.display = 'none';

            renderClients(id);
            window.scrollTo(0,0);
        }

        // æ¸²æŸ“å®¢æˆ¶åˆ—è¡¨
        function renderClients(salesId) {
            const list = document.getElementById('clientList');
            const countDiv = document.getElementById('countDisplay');
            list.innerHTML = "";

            if (typeof clientDB === 'undefined') {
                list.innerHTML = "<div class='p-3 text-center'>æ‰¾ä¸åˆ°è³‡æ–™åº« (customers.js)</div>";
                return;
            }

            // ç²å–è©²éŠ·å”®çš„æ‰€æœ‰å®¢æˆ¶
            let clients = [];
            for (let code in clientDB) {
                let c = clientDB[code];
                if (c.sales === salesId) {
                    clients.push({ code: code, ...c });
                }
            }

            // æ’åºï¼šæ•¸å­—ç·¨è™Ÿåœ¨å‰ï¼Œå­—æ¯åœ¨å¾Œ (å¯é¸ï¼Œé€™è£¡ç°¡å–®ç”¨ç·¨è™Ÿæ’)
            clients.sort((a, b) => a.code.localeCompare(b.code));

            // æ›´æ–°æ•¸é‡é¡¯ç¤º
            countDiv.innerText = `å…±æœ‰ ${clients.length} ä½å®¢æˆ¶`;

            // ç”Ÿæˆåˆ—è¡¨ HTML
            let html = "";
            clients.forEach(c => {
                const link = `index.html?id=${c.code}`;
                // data-search å±¬æ€§ç”¨ä¾†å­˜å„²æœç´¢é—œéµå­— (å…¨å¤§å¯«æ–¹ä¾¿æ¯”å°)
                html += `
                <a href="${link}" class="client-link" target="_blank" data-search="${c.name.toUpperCase()} ${c.code.toUpperCase()}">
                    <div class="list-group-item">
                        <span class="c-name">${c.name}</span>
                        <span class="c-code">${c.code} <i class="bi bi-box-arrow-up-right ms-2"></i></span>
                    </div>
                </a>
                `;
            });

            list.innerHTML = html || "<div class='p-5 text-center text-muted'>æš«ç„¡å®¢æˆ¶è³‡æ–™</div>";
        }

        // æ–°å®¢æˆ¶éˆæ¥ç”Ÿæˆ
        function filterNewClients() {
            document.querySelectorAll('.btn-sales').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('searchInput').value = ''; // æ¸…ç©ºæœç´¢
            document.getElementById('countDisplay').innerText = "ç”Ÿæˆç©ºç™½å–®éˆæ¥";

            const list = document.getElementById('clientList');
            let html = "";
            
            if (typeof salesTeam !== 'undefined') {
                for (let id in salesTeam) {
                    const s = salesTeam[id];
                    const link = `index.html?sales=${id}`;
                    // é€™è£¡ä¹ŸåŠ ä¸Š data-search è®“æœç´¢åŠŸèƒ½å°é€™è£¡ä¹Ÿæœ‰æ•ˆ
                    html += `
                    <a href="${link}" class="client-link" target="_blank" data-search="${s.name.toUpperCase()} æ–°å®¢æˆ¶">
                        <div class="list-group-item">
                            <span class="c-name">ğŸ“ ${s.name} (ç©ºç™½å–®)</span>
                            <span class="c-code">æ–°å®¢æˆ¶ <i class="bi bi-box-arrow-up-right ms-2"></i></span>
                        </div>
                    </a>
                    `;
                }
            }
            list.innerHTML = html;
        }

        // ğŸ”¥ æ ¸å¿ƒåŠŸèƒ½ï¼šæœç´¢éæ¿¾ ğŸ”¥
        function filterClients() {
            const input = document.getElementById('searchInput').value.toUpperCase();
            const items = document.querySelectorAll('.client-link');
            let hasResult = false;

            items.forEach(item => {
                // ç²å–è—åœ¨ data-search è£¡çš„åå­—å’Œç·¨è™Ÿ
                const text = item.getAttribute('data-search');
                
                if (text.includes(input)) {
                    item.style.display = ""; // é¡¯ç¤º
                    hasResult = true;
                } else {
                    item.style.display = "none"; // éš±è—
                }
            });

            // å¦‚æœå…¨éƒ¨éƒ½éš±è—äº†ï¼Œé¡¯ç¤ºã€Œæ‰¾ä¸åˆ°ã€
            document.getElementById('noResult').style.display = hasResult ? 'none' : 'block';
        }
    </script>
</body>
</html>
