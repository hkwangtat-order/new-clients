<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®é”å…§éƒ¨ - å®¢æˆ¶éˆæ¥ç¸½æ§å°</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffc107">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    
    <style>
        body { background-color: #f0f2f5; font-family: "Microsoft JhengHei", sans-serif; padding-bottom: 50px; }
        .header { background: #212529; color: #ffc107; padding: 15px; text-align: center; font-weight: bold; font-size: 1.1rem; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* å°èˆªæŒ‰éˆ•æ¨£å¼ */
        .nav-pills .nav-link { color: #555; font-weight: bold; background: white; margin: 0 4px; border: 1px solid #ddd; border-radius: 20px; font-size: 0.95rem; padding: 8px 15px; }
        .nav-pills .nav-link.active { background-color: #ffc107; color: black; border-color: #ffc107; }
        .nav-scroll { overflow-x: auto; white-space: nowrap; padding-bottom: 15px; -webkit-overflow-scrolling: touch; }
        
        /* === å¡ç‰‡æ¨£å¼ (V2.6 èˆ’é©ç‰ˆ) === */
        .client-card { 
            background: white; 
            border-radius: 10px; 
            padding: 16px 15px; 
            margin-bottom: 15px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            display: flex; 
            flex-direction: row; 
            justify-content: space-between; 
            align-items: center; 
            border-left: 5px solid #ddd; 
            gap: 10px; 
        }
        
        /* === å·¦å´ä¿¡æ¯ === */
        .client-info { 
            flex: 1; 
            min-width: 0; 
            margin-right: 5px;
        }
        .c-name { 
            font-size: 1.1rem; 
            font-weight: bold; 
            color: #333; 
            white-space: nowrap; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            margin-bottom: 2px;
            line-height: 1.3;
        }
        .c-code { 
            font-size: 0.8rem; 
            color: #999; 
            font-family: monospace; 
        }
        
        /* === å³å´æŒ‰éˆ•çµ„ === */
        .btn-group-custom { 
            display: flex; 
            gap: 8px; 
            flex-shrink: 0; 
        }
        
        /* === æŒ‰éˆ•æ¨£å¼ === */
        .btn-action { 
            border: none;
            color: white;
            font-weight: bold;
            font-size: 0.9rem;
            padding: 8px 14px;
            border-radius: 6px;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            white-space: nowrap;
            transition: opacity 0.2s;
            cursor: pointer; /* é¼ æ¨™æ‰‹å‹¢ */
        }
        .btn-action:hover { color: white; opacity: 0.9; }
        .btn-action:active { transform: scale(0.96); }

        .btn-blue { background-color: #0d6efd; }
        .btn-green { background-color: #198754; }
        .btn-dark { background-color: #212529; } 
        
    </style>
</head>
<body>

<div class="header">
    ğŸ¯ å®é”å®¢æˆ¶éˆæ¥åˆ†ç™¼ä¸­å¿ƒ
</div>

<div class="container">
    <div class="nav-scroll">
        <ul class="nav nav-pills justify-content-center mb-3" id="salesTabs">
            <li class="nav-item"><button class="nav-link" onclick="filterSales('NEW')"><i class="bi bi-people-fill"></i> æ–°å®¢æˆ¶å°ˆç”¨</button></li>
            
            <li class="nav-item"><button class="nav-link active" onclick="filterSales('A')">å¿—å“¥ (A)</button></li>
            <li class="nav-item"><button class="nav-link" onclick="filterSales('E')">äºŒä½¬ (E)</button></li>
            <li class="nav-item"><button class="nav-link" onclick="filterSales('B')">åšå£« (B)</button></li>
            <li class="nav-item"><button class="nav-link" onclick="filterSales('C')">å«¦å§ (C)</button></li>
            <li class="nav-item"><button class="nav-link" onclick="filterSales('D')">David (D)</button></li>
        </ul>
    </div>

    <div id="clientListArea"></div>
</div>

<script src="customers.js"></script>
<script>
    // âš ï¸ ç¢ºä¿é€™è£¡çš„ç¶²å€æ˜¯æ‚¨æœ€çµ‚ä¸Šç·šçš„ç¶²å€
    const baseUrl = "https://hkwangtat-order.github.io/new-clients/index.html";

    function init() {
        filterSales('A'); // é»˜èªé¡¯ç¤ºå¿—å“¥
    }

    function filterSales(salesCode) {
        // 1. æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.nav-link').forEach(btn => {
            btn.classList.remove('active');
            if(salesCode === 'NEW' && btn.innerText.includes('æ–°å®¢æˆ¶')) {
                btn.classList.add('active');
            } else if (salesCode !== 'NEW' && btn.innerText.includes(`(${salesCode})`)) {
                btn.classList.add('active');
            }
        });

        const container = document.getElementById('clientListArea');
        container.innerHTML = ''; 

        // === åˆ†æ”¯ 1ï¼šæ–°å®¢æˆ¶å°ˆç”¨ (ç°¡å–®ç›´æ¥ï¼Œä¸å½ˆçª—) ===
        if (salesCode === 'NEW') {
            const salesTeam = [
                { name: "å¿—å“¥ (A)", code: "A" },
                { name: "äºŒä½¬ (E)", code: "E" },
                { name: "åšå£« (B)", code: "B" },
                { name: "å«¦å§ (C)", code: "C" },
                { name: "David (D)", code: "D" }
            ];

            let html = '';
            salesTeam.forEach(s => {
                const link = `${baseUrl}?sales=${s.code}`;
                // æ–°å®¢æˆ¶ç°¡å–®è©±è¡“
                const msg = `ä½ å¥½ï¼Œé€™æ˜¯å®é”ç‚ºæ‚¨æº–å‚™çš„é›»å­è½å–®éˆæ¥ï¼Œè«‹é»æ“Šä¸‹å–®ï¼š\n${link}`;
                const waLink = `https://api.whatsapp.com/send?text=${encodeURIComponent(msg)}`;

                html += `
                    <div class="client-card" style="border-left-color: #333">
                        <div class="client-info">
                            <div class="c-name">${s.name} çš„æ–°å®¢æˆ¶</div>
                            <div class="c-code">é€šç”¨éˆæ¥ (General Link)</div>
                        </div>
                        
                        <div class="btn-group-custom">
                            <a href="${link}" target="_blank" class="btn-action btn-blue">
                                <i class="bi bi-search"></i> æª¢æŸ¥
                            </a>
                            <a href="${waLink}" target="_blank" class="btn-action btn-green">
                                <i class="bi bi-whatsapp"></i> è½‰ç™¼
                            </a>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
            return;
        }

        // === åˆ†æ”¯ 2ï¼šè€å®¢æˆ¶ (ä½¿ç”¨å½ˆçª—é¸æ“‡è©±è¡“) ===
        // å€’åºæ’åˆ—
        let clientArray = Object.entries(clientDB).reverse();

        let found = false;
        let html = '';

        for (const [id, data] of clientArray) {
            if (data.sales === salesCode) {
                found = true;
                const link = `${baseUrl}?id=${id}`;

                html += `
                    <div class="client-card" style="border-left-color: ${getColor(salesCode)}">
                        <div class="client-info">
                            <div class="c-name">${data.name}</div>
                            <div class="c-code">${id}</div>
                        </div>
                        
                        <div class="btn-group-custom">
                            <a href="${link}" target="_blank" class="btn-action btn-blue">
                                <i class="bi bi-search"></i> æª¢æŸ¥
                            </a>
                            <div onclick="copyLink('${id}', '${data.name}')" class="btn-action btn-green">
                                <i class="bi bi-whatsapp"></i> è½‰ç™¼
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        if (!found) {
            container.innerHTML = '<div class="text-center text-muted mt-5">æš«ç„¡æ­¤éŠ·å”®çš„å®¢æˆ¶è³‡æ–™</div>';
        } else {
            container.innerHTML = html;
        }
    }

    // === æ ¸å¿ƒåŠŸèƒ½ï¼šè€å®¢æˆ¶è©±è¡“é¸æ“‡ç³»çµ± (æ¸¯å¼ç„¡æŠ˜æ‰£ç‰ˆ) ===
    function copyLink(id, name) {
        const link = `${baseUrl}?id=${id}`;
        
        // è®“éŠ·å”®é¸æ“‡èªæ°£
        const choice = prompt(
            `è«‹é¸æ“‡ç™¼é€çµ¦ã€${name}ã€‘çš„è©±è¡“é¡å‹ (è¼¸å…¥æ•¸å­—)ï¼š\n\n` +
            `1. âœ¨ è²¼å¿ƒé‹ªæ’ (å¹«ä½  Set å¥½æ™’ã€ä¸€æ’³å³è½)\n` +
            `2. ğŸ›¡ï¸ é˜²éŒ¯ç©©é™£ (é©šæ¼å–®ã€ç›´æ¥å…¥ System)\n` +
            `3. ğŸ“¦ å³æ™‚åº«å­˜ (å””ä½¿å•æœ‰ç„¡è²¨ã€ä¸€ç‡å°±çŸ¥)\n` +
            `4. âš¡ ç³»çµ±å‡ç´š (çµ±ä¸€æµç¨‹ã€å¿«éšæ­£)\n` +
            `5. ğŸ”— åƒ…è¤‡è£½éˆæ¥`, 
            "1"
        );

        if (choice === null) return; // å¦‚æœæŒ‰å–æ¶ˆï¼Œä»€éº¼éƒ½ä¸åš

        let msg = "";

        if (choice === "1") {
            // è²¼å¿ƒç‰ˆ
            msg = `XXï¼Œå¹«ä½ æ•´å’—æ¢ã€å°ˆå±¬è½å–® Linkã€‘å–‡ï¼Œæˆ‘å·²ç¶“å°‡ä½ å¹³æ™‚å«é–‹å—°å•²è²¨ Set å¥½æ™’å–ºã€Œå¸¸ç”¨æ¸…å–®ã€åº¦ã€‚ä»¥å¾Œå””ä½¿æ‰“å­—å’ç…©ï¼Œå…¥å»æ’³å€‹æ£å°±ææ‚ï¼Œå¿«å¥½å¤šã—ï¼è¨˜å¾— Save ä½ä½¢ï¼š\n${link}`;
        } else if (choice === "2") {
            // é˜²éŒ¯ç‰ˆ
            msg = `XXï¼Œå› ç‚º WhatsApp å¤ªå¤šå–®é©šæœ‰æ™‚ç‡æ¼çœ¼æˆ–è€…å…¥éŒ¯å–®ã€‚ä»¥å¾Œéº»ç…©ç”¨å‘¢æ¢ Link è½å–®ï¼Œç›´æ¥é€£å…¥å…¬å¸ Systemï¼Œæº–ç¢ºå¥½å¤šåˆå””æœƒæ¼ï¼å¹«å¹«æ‰‹é…åˆä¸‹ï¼ŒThank youï¼\n${link}`;
        } else if (choice === "3") {
            // åº«å­˜ç‰ˆ
            msg = `XXï¼Œå…¬å¸ System Update å’—ï¼Œä»¥å¾Œç”¨å‘¢æ¢ Link å¯ä»¥ç›´æ¥ç‡åˆ°å³æ™‚è²¨å­˜ (æœ‰å†‡è²¨/ç¼ºè²¨)ã€‚å””ä½¿ç­‰æˆ‘è¦†å’æ…¢å˜›ï¼Œä½ è‡ªå·±ç‡å®Œç›´æ¥è½å–®å°±å¾—ï¼Œæ–¹ä¾¿å¥½å¤šï¼\n${link}`;
        } else if (choice === "4") {
            // å‡ç´šç‰ˆ
            msg = `ã€å®é”é€šçŸ¥ã€‘XX ä½ å¥½ï¼Œç‚ºå’—åŠ å¿«å‡ºè²¨æµç¨‹ï¼Œå…¬å¸å…¨é¢æ¨è¡Œè‡ªåŠ©è½å–®ã€‚ä»¥å¾Œéº»ç…©ç›¡é‡ç”¨å‘¢æ¢å°ˆå±¬ Linkï¼Œä¸€æ’³å°±ä¿‚ï¼Œå””ä½¿æ‰“å­—éŒ„éŸ³å’è²»ç¥ï¼Œå¤šè¬åˆä½œï¼\n${link}`;
        } else {
            // åƒ…è¤‡è£½éˆæ¥
            msg = link;
        }

        // æŠŠåå­—æ›¿æ›é€²å»
        msg = msg.replace("XX", name);

        // è¤‡è£½åˆ°å‰ªè²¼ç°¿ä¸¦æç¤º
        navigator.clipboard.writeText(msg).then(() => {
            alert(`âœ… è¤‡è£½æˆåŠŸï¼\n\nå°è±¡ï¼š${name}\næ¨¡å¼ï¼š${choice}\n\nè«‹ç›´æ¥å» WhatsApp è²¼ä¸Šå³å¯ï¼`);
        }).catch(err => {
            prompt("è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹å…§å®¹ï¼š", msg);
        });
    }

    function getColor(code) {
        const colors = { 'A': '#0d6efd', 'E': '#198754', 'B': '#dc3545', 'C': '#ffc107', 'D': '#6f42c1' };
        return colors[code] || '#ccc';
    }

    init();
</script>

</body>
</html>
